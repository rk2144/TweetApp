{% extends "layout.html" %}

{% block title %}Home{% endblock %}

{% block content %}
<div class="text-center">
    <h1 class="fw-bold text-primary">Welcome to Chat&Tweet üöÄ</h1>
    <p class="lead text-light">Share your thoughts & connect with friends!</p>

    {% if user.is_authenticated %}
        <div class="card my-3 p-3">
            <h5>Create a new Tweet</h5>
            <form method="post" enctype="multipart/form-data" action="{% url 'tweet_create' %}">
                {% csrf_token %}
                {{ form.as_p }}
                <button class="btn btn-success" type="submit">Tweet</button>
            </form>
        </div>
    {% else %}
        <p class="text-warning">Login to create a tweet!</p>
    {% endif %}

    <!-- Trending Tweets -->
    <h3 class="text-light mt-4">üî• Trending Tweets</h3>
    <div class="row justify-content-center">
        {% for tweet in trending_tweets %}
        <div class="col-md-4">
            <div class="card my-2">
                <div class="card-body">
                    <h5 class="card-title">@{{ tweet.user.username }}</h5>
                    <p class="card-text">{{ tweet.text|truncatechars:100 }}</p>
                    <button class="btn btn-outline-danger like-btn" data-tweet-id="{{ tweet.id }}">
                        ‚ù§Ô∏è <span class="likes-count">{{ tweet.total_likes }}</span>
                    </button>
                    <a href="{% url 'tweet_detail' tweet.id %}" class="btn btn-outline-info btn-sm mt-2">View Details</a>
                </div>
            </div>
        </div>
        {% empty %}
        <p class="text-muted">No trending tweets yet.</p>
        {% endfor %}
    </div>

    <!-- Latest Tweets -->
    <h3 class="text-light mt-4">üÜï Latest Tweets</h3>
    <div class="row justify-content-center">
        {% for tweet in latest_tweets %}
        <div class="col-md-4">
            <div class="card my-2">
                <div class="card-body">
                    <h5 class="card-title">@{{ tweet.user.username }}</h5>
                    <p class="card-text">{{ tweet.text|truncatechars:100 }}</p>
                    <button class="btn btn-outline-danger like-btn" data-tweet-id="{{ tweet.id }}">
                        ‚ù§Ô∏è <span class="likes-count">{{ tweet.total_likes }}</span>
                    </button>
                    <a href="{% url 'tweet_detail' tweet.id %}" class="btn btn-outline-info btn-sm mt-2">View Details</a>
                </div>
            </div>
        </div>
        {% empty %}
        <p class="text-muted">No tweets yet.</p>
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
$(document).ready(function(){
    $('.like-btn').click(function(){
        let btn = $(this);
        let tweetId = btn.data('tweet-id');
        $.ajax({
            url: '/' + tweetId + '/like_ajax/',
            type: 'POST',
            data: {'csrfmiddlewaretoken': '{{ csrf_token }}'},
            success: function(response){
                btn.find('.likes-count').text(response.likes_count);
            }
        });
    });
});
</script>
{% endblock %}
